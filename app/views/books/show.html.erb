<!--改行するためのメソッドを定義-->
<% str = "\n" %>
<% def html_safe_newline(str) h(str).gsub(/\n|\r|\r\n/, "<br>").html_safe end %>
<!--ここまで-->


<div class="container px-5 px-sm-0">
  <% if @book_comment.errors.any? %>
    <div id="error_explanation">
      <div class="error-message">&nbsp;&nbsp;<%= @book_comment.errors.count %> error occurred</div>
      <ul>
        <% @book_comment.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<% if flash[:notice] %>
    <p id="notice"><%= flash[:notice] %></p>
<% end %>

<div class="container">
  <div class="row">
    <div class='col-md-3'>
      <h2>User info</h2>
      <%= render partial: 'users/info', locals: { user: @user } %>
      <div>
        <%= render partial: 'users/relationship', locals: { user: @user } %> 
      </div>
      <h2 class="mt-3">New book</h2>
      <%= render partial: 'form', locals: { book: @new_book } %>  
    </div>
    
    <div class="col-md-8 offset-md-1">
      <h2>Book detail</h2>
      <table class="table tbl-r02">
        <tbody>
            <tr>
              <td class="list-box list-body">
                <% if @user.profile_image.attached? %>
                  <%= image_tag @user.get_profile_image(100,100) %>
                <% else %>
                  <%= image_tag 'no_image', size: "100x100" %>
                <% end %>
                <div><%= link_to @user.name,user_path(@user) %></div>
              </td>
              <td class="list-box">
                <%= @book.title %>
              </td>
              <td class="list-box list-body">
                <%= @book.body %>
              </td>
              <td id="favorite_buttons_<%= @book.id %>">
                <% if current_user == @user %>
                  <div>
                    <%= link_to "Edit",edit_book_path(@book), class: "btn btn-sm btn-success" %>
                    <%= link_to "Destroy", destroy_book_path(@book), method: :delete, "data-confirm" => "本当に削除しますか？", class: "btn btn-sm btn-danger" %>
                  </div>
                <% end %>
                <%= render "favorites/favorite", book: @book %>
              </td>
            </tr>
        </tbody>
      </table>
      <div id="book_comments_<%= @book.id %>">
        <%= render "book_comments/book_comments", book: @book %>
        <%= form_with model: [@book, @book_comment], remote: true do |f| %>
          <%= f.text_area :comment, rows: '5', placeholder: "comments here", class: "form-control" %>
          <div>
            <%= f.submit "Send", class: "btn btn-secondary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
</div>
</div>